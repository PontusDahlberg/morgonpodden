name: ğŸ”„ Backup Episode Download

# KÃ¶r backup-nedladdning varje timme mellan 18:00-22:00 svensk tid som fallback
on:
  schedule:
    # KÃ¶r varje timme frÃ¥n 16:00-20:00 UTC (18:00-22:00 svensk tid)
    - cron: '0 16 * * *'  # 16:00 UTC = 18:00 svensk tid
    - cron: '0 17 * * *'  # 17:00 UTC = 19:00 svensk tid
    - cron: '0 18 * * *'  # 18:00 UTC = 20:00 svensk tid
    - cron: '0 19 * * *'  # 19:00 UTC = 21:00 svensk tid
    - cron: '0 20 * * *'  # 20:00 UTC = 22:00 svensk tid
  workflow_dispatch:  # Manuell kÃ¶rning fÃ¶r testning

env:
  PYTHON_VERSION: '3.10'

jobs:
  backup-download:
    name: ğŸ“¥ Backup Download Episodes
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests urllib3 schedule
        
    - name: ğŸ”„ Run backup download
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "ğŸ• $(date): Startar backup-nedladdning..."
        python auto_episode_downloader.py
        echo "âœ… $(date): Backup-nedladdning slutfÃ¶rd"
        
    - name: ğŸ“ Upload download logs
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: backup-download-logs-${{ github.run_number }}
        path: |
          auto_download.log
          local_episodes/
        retention-days: 7
        
    - name: ğŸ“Š Display download status
      if: always()
      run: |
        echo "ğŸ“Š Backup Download Status Report:"
        echo "ğŸ• Tid: $(date)"
        if [ -f "auto_download.log" ]; then
          echo "ğŸ“ Senaste loggposter:"
          tail -10 auto_download.log
        fi
        if [ -d "local_episodes" ]; then
          echo "ğŸ“ Lokala episoder:"
          ls -la local_episodes/ || echo "Inga lokala episoder hittades"
        fi